{
  "omopTable": "Observation",
  "origin": "COSD",
  "omopColumns": [
    {
      "name": "nhs_number",
      "operation_description": "Value copied from `NhsNumber`",
      "dataSource": [
        {
          "name": "NhsNumber",
          "description": "Patient NHS Number",
          "origins": [
            {
              "origin": "NHS NUMBER",
              "url": "https://www.datadictionary.nhs.uk/data_elements/nhs_number.html"
            }
          ]
        }
      ],
      "query": "\nwith LU as (\n    select\n        Record ->> '$.PrimaryPathway.ReferralAndFirstStageOfPatientPathway.DateFirstSeen' as DateFirstSeen,\n        Record ->> '$.PrimaryPathway.ReferralAndFirstStageOfPatientPathway.DateFirstSeenCancerSpecialist' as DateFirstSeenCancerSpecialist,\n        Record ->> '$.PrimaryPathway.LinkageDiagnosticDetails.DateOfPrimaryDiagnosisClinicallyAgreed' as DateOfPrimaryDiagnosisClinicallyAgreed,\n        Record ->> '$.PrimaryPathway.Staging.StageDateFinalPretreatmentStage' as StageDateFinalPretreatmentStage,\n        Record ->> '$.PrimaryPathway.Staging.StageDateIntegratedStage' as StageDateIntegratedStage,\n        Record ->> '$.Treatment.TreatmentStartDateCancer' as TreatmentStartDateCancer,\n        Record ->> '$.Treatment.Surgery.ProcedureDate' as ProcedureDate,\n        Record ->> '$.ClinicalNurseSpecialistAndRiskFactorAssessments.HistoryOfAlcoholPast.@code' as HistoryOfAlcoholPast,\n        Record ->> '$.LinkagePatientId.NhsNumber.@extension' as NhsNumber\n    from omop_staging.cosd_staging_901\n    where type = 'LU'\n)\nselect\n    distinct\n        HistoryOfAlcoholPast,\n        NhsNumber,\n        least(\n            cast(DateFirstSeen as date),\n            cast(DateFirstSeenCancerSpecialist as date),\n            cast(DateOfPrimaryDiagnosisClinicallyAgreed as date),\n            cast(StageDateFinalPretreatmentStage as date),\n            cast(StageDateIntegratedStage as date),\n            cast(TreatmentStartDateCancer as date),\n            cast(ProcedureDate as date)\n        ) as Date\nfrom LU o\nwhere o.HistoryOfAlcoholPast is not null\n  and not (\n        DateFirstSeen is null and\n        DateFirstSeenCancerSpecialist is null and\n        DateOfPrimaryDiagnosisClinicallyAgreed is null and\n        StageDateFinalPretreatmentStage is null and\n        StageDateIntegratedStage is null and\n        TreatmentStartDateCancer is null and\n        ProcedureDate is null\n    )\n    ",
      "lookup_table_markdown": null
    },
    {
      "name": "observation_concept_id",
      "operation_description": "Constant value set to `44782821`. Finding of alcohol consumption",
      "dataSource": null,
      "query": null,
      "lookup_table_markdown": null
    },
    {
      "name": "observation_date",
      "operation_description": "Value copied from `Date`",
      "dataSource": [
        {
          "name": "Date",
          "description": "Observation date",
          "origins": [
            {
              "origin": "DATE FIRST SEEN",
              "url": "https://www.datadictionary.nhs.uk/data_elements/date_first_seen.html"
            },
            {
              "origin": "DATE FIRST SEEN (CANCER SPECIALIST)",
              "url": "https://www.datadictionary.nhs.uk/data_elements/date_first_seen__cancer_specialist_.html"
            },
            {
              "origin": "DATE OF PRIMARY CANCER DIAGNOSIS (CLINICALLY AGREED)",
              "url": "https://www.datadictionary.nhs.uk/data_elements/date_of_primary_cancer_diagnosis__clinically_agreed_.html"
            },
            {
              "origin": "TNM STAGE GROUPING DATE (FINAL PRETREATMENT)",
              "url": "https://www.datadictionary.nhs.uk/data_elements/tnm_stage_grouping_date__final_pretreatment_.html"
            },
            {
              "origin": "TNM STAGE GROUPING DATE (INTEGRATED)",
              "url": "https://www.datadictionary.nhs.uk/data_elements/tnm_stage_grouping_date__integrated_.html"
            },
            {
              "origin": "TREATMENT START DATE (CANCER)",
              "url": "https://www.datadictionary.nhs.uk/data_elements/treatment_start_date__cancer_.html"
            },
            {
              "origin": "PROCEDURE DATE",
              "url": "https://www.datadictionary.nhs.uk/data_elements/procedure_date.html"
            }
          ]
        }
      ],
      "query": "\nwith LU as (\n    select\n        Record ->> '$.PrimaryPathway.ReferralAndFirstStageOfPatientPathway.DateFirstSeen' as DateFirstSeen,\n        Record ->> '$.PrimaryPathway.ReferralAndFirstStageOfPatientPathway.DateFirstSeenCancerSpecialist' as DateFirstSeenCancerSpecialist,\n        Record ->> '$.PrimaryPathway.LinkageDiagnosticDetails.DateOfPrimaryDiagnosisClinicallyAgreed' as DateOfPrimaryDiagnosisClinicallyAgreed,\n        Record ->> '$.PrimaryPathway.Staging.StageDateFinalPretreatmentStage' as StageDateFinalPretreatmentStage,\n        Record ->> '$.PrimaryPathway.Staging.StageDateIntegratedStage' as StageDateIntegratedStage,\n        Record ->> '$.Treatment.TreatmentStartDateCancer' as TreatmentStartDateCancer,\n        Record ->> '$.Treatment.Surgery.ProcedureDate' as ProcedureDate,\n        Record ->> '$.ClinicalNurseSpecialistAndRiskFactorAssessments.HistoryOfAlcoholPast.@code' as HistoryOfAlcoholPast,\n        Record ->> '$.LinkagePatientId.NhsNumber.@extension' as NhsNumber\n    from omop_staging.cosd_staging_901\n    where type = 'LU'\n)\nselect\n    distinct\n        HistoryOfAlcoholPast,\n        NhsNumber,\n        least(\n            cast(DateFirstSeen as date),\n            cast(DateFirstSeenCancerSpecialist as date),\n            cast(DateOfPrimaryDiagnosisClinicallyAgreed as date),\n            cast(StageDateFinalPretreatmentStage as date),\n            cast(StageDateIntegratedStage as date),\n            cast(TreatmentStartDateCancer as date),\n            cast(ProcedureDate as date)\n        ) as Date\nfrom LU o\nwhere o.HistoryOfAlcoholPast is not null\n  and not (\n        DateFirstSeen is null and\n        DateFirstSeenCancerSpecialist is null and\n        DateOfPrimaryDiagnosisClinicallyAgreed is null and\n        StageDateFinalPretreatmentStage is null and\n        StageDateIntegratedStage is null and\n        TreatmentStartDateCancer is null and\n        ProcedureDate is null\n    )\n    ",
      "lookup_table_markdown": null
    },
    {
      "name": "observation_datetime",
      "operation_description": "Value copied from `Date`",
      "dataSource": [
        {
          "name": "Date",
          "description": "Observation date",
          "origins": [
            {
              "origin": "DATE FIRST SEEN",
              "url": "https://www.datadictionary.nhs.uk/data_elements/date_first_seen.html"
            },
            {
              "origin": "DATE FIRST SEEN (CANCER SPECIALIST)",
              "url": "https://www.datadictionary.nhs.uk/data_elements/date_first_seen__cancer_specialist_.html"
            },
            {
              "origin": "DATE OF PRIMARY CANCER DIAGNOSIS (CLINICALLY AGREED)",
              "url": "https://www.datadictionary.nhs.uk/data_elements/date_of_primary_cancer_diagnosis__clinically_agreed_.html"
            },
            {
              "origin": "TNM STAGE GROUPING DATE (FINAL PRETREATMENT)",
              "url": "https://www.datadictionary.nhs.uk/data_elements/tnm_stage_grouping_date__final_pretreatment_.html"
            },
            {
              "origin": "TNM STAGE GROUPING DATE (INTEGRATED)",
              "url": "https://www.datadictionary.nhs.uk/data_elements/tnm_stage_grouping_date__integrated_.html"
            },
            {
              "origin": "TREATMENT START DATE (CANCER)",
              "url": "https://www.datadictionary.nhs.uk/data_elements/treatment_start_date__cancer_.html"
            },
            {
              "origin": "PROCEDURE DATE",
              "url": "https://www.datadictionary.nhs.uk/data_elements/procedure_date.html"
            }
          ]
        }
      ],
      "query": "\nwith LU as (\n    select\n        Record ->> '$.PrimaryPathway.ReferralAndFirstStageOfPatientPathway.DateFirstSeen' as DateFirstSeen,\n        Record ->> '$.PrimaryPathway.ReferralAndFirstStageOfPatientPathway.DateFirstSeenCancerSpecialist' as DateFirstSeenCancerSpecialist,\n        Record ->> '$.PrimaryPathway.LinkageDiagnosticDetails.DateOfPrimaryDiagnosisClinicallyAgreed' as DateOfPrimaryDiagnosisClinicallyAgreed,\n        Record ->> '$.PrimaryPathway.Staging.StageDateFinalPretreatmentStage' as StageDateFinalPretreatmentStage,\n        Record ->> '$.PrimaryPathway.Staging.StageDateIntegratedStage' as StageDateIntegratedStage,\n        Record ->> '$.Treatment.TreatmentStartDateCancer' as TreatmentStartDateCancer,\n        Record ->> '$.Treatment.Surgery.ProcedureDate' as ProcedureDate,\n        Record ->> '$.ClinicalNurseSpecialistAndRiskFactorAssessments.HistoryOfAlcoholPast.@code' as HistoryOfAlcoholPast,\n        Record ->> '$.LinkagePatientId.NhsNumber.@extension' as NhsNumber\n    from omop_staging.cosd_staging_901\n    where type = 'LU'\n)\nselect\n    distinct\n        HistoryOfAlcoholPast,\n        NhsNumber,\n        least(\n            cast(DateFirstSeen as date),\n            cast(DateFirstSeenCancerSpecialist as date),\n            cast(DateOfPrimaryDiagnosisClinicallyAgreed as date),\n            cast(StageDateFinalPretreatmentStage as date),\n            cast(StageDateIntegratedStage as date),\n            cast(TreatmentStartDateCancer as date),\n            cast(ProcedureDate as date)\n        ) as Date\nfrom LU o\nwhere o.HistoryOfAlcoholPast is not null\n  and not (\n        DateFirstSeen is null and\n        DateFirstSeenCancerSpecialist is null and\n        DateOfPrimaryDiagnosisClinicallyAgreed is null and\n        StageDateFinalPretreatmentStage is null and\n        StageDateIntegratedStage is null and\n        TreatmentStartDateCancer is null and\n        ProcedureDate is null\n    )\n    ",
      "lookup_table_markdown": null
    },
    {
      "name": "observation_type_concept_id",
      "operation_description": "Constant value set to `32828`. `EHR episode record`",
      "dataSource": null,
      "query": null,
      "lookup_table_markdown": null
    },
    {
      "name": "value_as_string",
      "operation_description": "Value copied from `HistoryOfAlcoholPast`",
      "dataSource": [
        {
          "name": "HistoryOfAlcoholPast",
          "description": "The past history of alcohol consumption for the PATIENT during a Cancer Care Spell.",
          "origins": [
            {
              "origin": "HISTORY OF ALCOHOL (PAST)",
              "url": null
            }
          ]
        }
      ],
      "query": "\nwith LU as (\n    select\n        Record ->> '$.PrimaryPathway.ReferralAndFirstStageOfPatientPathway.DateFirstSeen' as DateFirstSeen,\n        Record ->> '$.PrimaryPathway.ReferralAndFirstStageOfPatientPathway.DateFirstSeenCancerSpecialist' as DateFirstSeenCancerSpecialist,\n        Record ->> '$.PrimaryPathway.LinkageDiagnosticDetails.DateOfPrimaryDiagnosisClinicallyAgreed' as DateOfPrimaryDiagnosisClinicallyAgreed,\n        Record ->> '$.PrimaryPathway.Staging.StageDateFinalPretreatmentStage' as StageDateFinalPretreatmentStage,\n        Record ->> '$.PrimaryPathway.Staging.StageDateIntegratedStage' as StageDateIntegratedStage,\n        Record ->> '$.Treatment.TreatmentStartDateCancer' as TreatmentStartDateCancer,\n        Record ->> '$.Treatment.Surgery.ProcedureDate' as ProcedureDate,\n        Record ->> '$.ClinicalNurseSpecialistAndRiskFactorAssessments.HistoryOfAlcoholPast.@code' as HistoryOfAlcoholPast,\n        Record ->> '$.LinkagePatientId.NhsNumber.@extension' as NhsNumber\n    from omop_staging.cosd_staging_901\n    where type = 'LU'\n)\nselect\n    distinct\n        HistoryOfAlcoholPast,\n        NhsNumber,\n        least(\n            cast(DateFirstSeen as date),\n            cast(DateFirstSeenCancerSpecialist as date),\n            cast(DateOfPrimaryDiagnosisClinicallyAgreed as date),\n            cast(StageDateFinalPretreatmentStage as date),\n            cast(StageDateIntegratedStage as date),\n            cast(TreatmentStartDateCancer as date),\n            cast(ProcedureDate as date)\n        ) as Date\nfrom LU o\nwhere o.HistoryOfAlcoholPast is not null\n  and not (\n        DateFirstSeen is null and\n        DateFirstSeenCancerSpecialist is null and\n        DateOfPrimaryDiagnosisClinicallyAgreed is null and\n        StageDateFinalPretreatmentStage is null and\n        StageDateIntegratedStage is null and\n        TreatmentStartDateCancer is null and\n        ProcedureDate is null\n    )\n    ",
      "lookup_table_markdown": null
    }
  ]
}
{
  "omopTable": "ConditionOccurrence",
  "origin": "COSD",
  "omopColumns": [
    {
      "name": "nhs_number",
      "operation_description": "Value copied from `NhsNumber`",
      "dataSource": [
        {
          "name": "NhsNumber",
          "description": "Patient NHS Number",
          "origins": [
            {
              "origin": "NHS NUMBER",
              "url": "https://www.datadictionary.nhs.uk/data_elements/nhs_number.html"
            }
          ]
        }
      ],
      "query": "\nwith BR as (\n  select \n    Record ->> '$.Breast.BreastCore.BreastCoreLinkagePatientId.NHSNumber.@extension' as NhsNumber,\n    Record ->> '$.Breast.BreastCore.BreastCoreLinkageDiagnosticDetails.ClinicalDateCancerDiagnosis' as DiagnosisDate,\n    Record ->> '$.Breast.BreastCore.BreastCoreLinkageDiagnosticDetails.DateOfNonPrimaryCancerDiagnosisClinicallyAgreed' as NonPrimaryDiagnosisDate,\n    Record ->> '$.Breast.BreastCore.BreastCoreDiagnosis.MorphologyICDODiagnosis.@code' as CancerHistology,\n    Record ->> '$.Breast.BreastCore.BreastCoreDiagnosis.TopographyICDO.@code' as CancerTopography,\n    Record ->> '$.Breast.BreastCore.BreastCoreDiagnosis.BasisOfCancerDiagnosis.@code' as BasisOfDiagnosisCancer,\n    Record ->> '$.Breast.BreastCore.BreastCoreLinkageDiagnosticDetails.PrimaryDiagnosis.@code' as CancerDiagnosis\n  from omop_staging.cosd_staging_81\nwhere Type = 'BR'\n)\nselect \n    distinct\n        NhsNumber,\n        coalesce (DiagnosisDate, NonPrimaryDiagnosisDate) as DiagnosisDate,\n        BasisOfDiagnosisCancer,\n        CancerHistology,\n        CancerTopography\nfrom BR\nwhere NhsNumber is not null and\n    (\n        DiagnosisDate is not null or \n        NonPrimaryDiagnosisDate is not null\n    )\n    and (CancerHistology is not null and CancerTopography is not null)\n    ",
      "lookup_table_markdown": null
    },
    {
      "name": "condition_source_concept_id",
      "operation_description": "Resolve ICD-o-3 codes to OMOP concepts.",
      "dataSource": [
        {
          "name": "CancerHistology",
          "description": "MORPHOLOGY (ICD-O CANCER TRANSFORMATION) is the morphology code of the Cancer Transformation using the ICD-O CODE.",
          "origins": [
            {
              "origin": "MORPHOLOGY (ICD-O CANCER TRANSFORMATION)",
              "url": "https://www.datadictionary.nhs.uk/data_elements/morphology__icd-o_cancer_transformation_.html"
            }
          ]
        },
        {
          "name": "CancerTopography",
          "description": "TOPOGRAPHY (ICD-O) is the topographical site of the Tumour using the ICD-O CODE.",
          "origins": [
            {
              "origin": "TOPOGRAPHY (ICD-O)",
              "url": "https://www.datadictionary.nhs.uk/data_elements/topography__icd-o_.html"
            }
          ]
        }
      ],
      "query": "\nwith BR as (\n  select \n    Record ->> '$.Breast.BreastCore.BreastCoreLinkagePatientId.NHSNumber.@extension' as NhsNumber,\n    Record ->> '$.Breast.BreastCore.BreastCoreLinkageDiagnosticDetails.ClinicalDateCancerDiagnosis' as DiagnosisDate,\n    Record ->> '$.Breast.BreastCore.BreastCoreLinkageDiagnosticDetails.DateOfNonPrimaryCancerDiagnosisClinicallyAgreed' as NonPrimaryDiagnosisDate,\n    Record ->> '$.Breast.BreastCore.BreastCoreDiagnosis.MorphologyICDODiagnosis.@code' as CancerHistology,\n    Record ->> '$.Breast.BreastCore.BreastCoreDiagnosis.TopographyICDO.@code' as CancerTopography,\n    Record ->> '$.Breast.BreastCore.BreastCoreDiagnosis.BasisOfCancerDiagnosis.@code' as BasisOfDiagnosisCancer,\n    Record ->> '$.Breast.BreastCore.BreastCoreLinkageDiagnosticDetails.PrimaryDiagnosis.@code' as CancerDiagnosis\n  from omop_staging.cosd_staging_81\nwhere Type = 'BR'\n)\nselect \n    distinct\n        NhsNumber,\n        coalesce (DiagnosisDate, NonPrimaryDiagnosisDate) as DiagnosisDate,\n        BasisOfDiagnosisCancer,\n        CancerHistology,\n        CancerTopography\nfrom BR\nwhere NhsNumber is not null and\n    (\n        DiagnosisDate is not null or \n        NonPrimaryDiagnosisDate is not null\n    )\n    and (CancerHistology is not null and CancerTopography is not null)\n    ",
      "lookup_table_markdown": null
    },
    {
      "name": "condition_concept_id",
      "operation_description": "Maps concepts to standard valid concepts in the `condition` domain.",
      "dataSource": null,
      "query": null,
      "lookup_table_markdown": null
    },
    {
      "name": "condition_start_date",
      "operation_description": "Converts text to dates.",
      "dataSource": [
        {
          "name": "DiagnosisDate",
          "description": "DATE OF PRIMARY CANCER DIAGNOSIS (CLINICALLY AGREED) is the date the Primary Cancer was confirmed or the Primary Cancer diagnosis was agreed.",
          "origins": [
            {
              "origin": "DATE OF PRIMARY CANCER DIAGNOSIS (CLINICALLY AGREED)",
              "url": "https://www.datadictionary.nhs.uk/data_elements/date_of_primary_cancer_diagnosis__clinically_agreed_.html"
            },
            {
              "origin": "DATE OF NON PRIMARY CANCER DIAGNOSIS (CLINICALLY AGREED)",
              "url": "https://www.datadictionary.nhs.uk/data_elements/date_of_non_primary_cancer_diagnosis__clinically_agreed_.html"
            }
          ]
        }
      ],
      "query": "\nwith BR as (\n  select \n    Record ->> '$.Breast.BreastCore.BreastCoreLinkagePatientId.NHSNumber.@extension' as NhsNumber,\n    Record ->> '$.Breast.BreastCore.BreastCoreLinkageDiagnosticDetails.ClinicalDateCancerDiagnosis' as DiagnosisDate,\n    Record ->> '$.Breast.BreastCore.BreastCoreLinkageDiagnosticDetails.DateOfNonPrimaryCancerDiagnosisClinicallyAgreed' as NonPrimaryDiagnosisDate,\n    Record ->> '$.Breast.BreastCore.BreastCoreDiagnosis.MorphologyICDODiagnosis.@code' as CancerHistology,\n    Record ->> '$.Breast.BreastCore.BreastCoreDiagnosis.TopographyICDO.@code' as CancerTopography,\n    Record ->> '$.Breast.BreastCore.BreastCoreDiagnosis.BasisOfCancerDiagnosis.@code' as BasisOfDiagnosisCancer,\n    Record ->> '$.Breast.BreastCore.BreastCoreLinkageDiagnosticDetails.PrimaryDiagnosis.@code' as CancerDiagnosis\n  from omop_staging.cosd_staging_81\nwhere Type = 'BR'\n)\nselect \n    distinct\n        NhsNumber,\n        coalesce (DiagnosisDate, NonPrimaryDiagnosisDate) as DiagnosisDate,\n        BasisOfDiagnosisCancer,\n        CancerHistology,\n        CancerTopography\nfrom BR\nwhere NhsNumber is not null and\n    (\n        DiagnosisDate is not null or \n        NonPrimaryDiagnosisDate is not null\n    )\n    and (CancerHistology is not null and CancerTopography is not null)\n    ",
      "lookup_table_markdown": null
    },
    {
      "name": "condition_source_value",
      "operation_description": "Separates text with newlines. Trim whitespace.",
      "dataSource": [
        {
          "name": "CancerHistology",
          "description": "MORPHOLOGY (ICD-O CANCER TRANSFORMATION) is the morphology code of the Cancer Transformation using the ICD-O CODE.",
          "origins": [
            {
              "origin": "MORPHOLOGY (ICD-O CANCER TRANSFORMATION)",
              "url": "https://www.datadictionary.nhs.uk/data_elements/morphology__icd-o_cancer_transformation_.html"
            }
          ]
        },
        {
          "name": "CancerTopography",
          "description": "TOPOGRAPHY (ICD-O) is the topographical site of the Tumour using the ICD-O CODE.",
          "origins": [
            {
              "origin": "TOPOGRAPHY (ICD-O)",
              "url": "https://www.datadictionary.nhs.uk/data_elements/topography__icd-o_.html"
            }
          ]
        }
      ],
      "query": "\nwith BR as (\n  select \n    Record ->> '$.Breast.BreastCore.BreastCoreLinkagePatientId.NHSNumber.@extension' as NhsNumber,\n    Record ->> '$.Breast.BreastCore.BreastCoreLinkageDiagnosticDetails.ClinicalDateCancerDiagnosis' as DiagnosisDate,\n    Record ->> '$.Breast.BreastCore.BreastCoreLinkageDiagnosticDetails.DateOfNonPrimaryCancerDiagnosisClinicallyAgreed' as NonPrimaryDiagnosisDate,\n    Record ->> '$.Breast.BreastCore.BreastCoreDiagnosis.MorphologyICDODiagnosis.@code' as CancerHistology,\n    Record ->> '$.Breast.BreastCore.BreastCoreDiagnosis.TopographyICDO.@code' as CancerTopography,\n    Record ->> '$.Breast.BreastCore.BreastCoreDiagnosis.BasisOfCancerDiagnosis.@code' as BasisOfDiagnosisCancer,\n    Record ->> '$.Breast.BreastCore.BreastCoreLinkageDiagnosticDetails.PrimaryDiagnosis.@code' as CancerDiagnosis\n  from omop_staging.cosd_staging_81\nwhere Type = 'BR'\n)\nselect \n    distinct\n        NhsNumber,\n        coalesce (DiagnosisDate, NonPrimaryDiagnosisDate) as DiagnosisDate,\n        BasisOfDiagnosisCancer,\n        CancerHistology,\n        CancerTopography\nfrom BR\nwhere NhsNumber is not null and\n    (\n        DiagnosisDate is not null or \n        NonPrimaryDiagnosisDate is not null\n    )\n    and (CancerHistology is not null and CancerTopography is not null)\n    ",
      "lookup_table_markdown": null
    },
    {
      "name": "condition_type_concept_id",
      "operation_description": "Constant value set to `32828`. `EHR episode record`",
      "dataSource": null,
      "query": null,
      "lookup_table_markdown": null
    },
    {
      "name": "condition_status_concept_id",
      "operation_description": "Lookup NHS Data Dictionary Basis Of Diagnosis Cancer",
      "dataSource": [
        {
          "name": "BasisOfDiagnosisCancer",
          "description": "The basis of how a PATIENT DIAGNOSIS relating to cancer was identified.",
          "origins": [
            {
              "origin": "BASIS OF DIAGNOSIS (CANCER)",
              "url": "https://www.datadictionary.nhs.uk/data_elements/basis_of_diagnosis__cancer_.html"
            }
          ]
        }
      ],
      "query": "\nwith BR as (\n  select \n    Record ->> '$.Breast.BreastCore.BreastCoreLinkagePatientId.NHSNumber.@extension' as NhsNumber,\n    Record ->> '$.Breast.BreastCore.BreastCoreLinkageDiagnosticDetails.ClinicalDateCancerDiagnosis' as DiagnosisDate,\n    Record ->> '$.Breast.BreastCore.BreastCoreLinkageDiagnosticDetails.DateOfNonPrimaryCancerDiagnosisClinicallyAgreed' as NonPrimaryDiagnosisDate,\n    Record ->> '$.Breast.BreastCore.BreastCoreDiagnosis.MorphologyICDODiagnosis.@code' as CancerHistology,\n    Record ->> '$.Breast.BreastCore.BreastCoreDiagnosis.TopographyICDO.@code' as CancerTopography,\n    Record ->> '$.Breast.BreastCore.BreastCoreDiagnosis.BasisOfCancerDiagnosis.@code' as BasisOfDiagnosisCancer,\n    Record ->> '$.Breast.BreastCore.BreastCoreLinkageDiagnosticDetails.PrimaryDiagnosis.@code' as CancerDiagnosis\n  from omop_staging.cosd_staging_81\nwhere Type = 'BR'\n)\nselect \n    distinct\n        NhsNumber,\n        coalesce (DiagnosisDate, NonPrimaryDiagnosisDate) as DiagnosisDate,\n        BasisOfDiagnosisCancer,\n        CancerHistology,\n        CancerTopography\nfrom BR\nwhere NhsNumber is not null and\n    (\n        DiagnosisDate is not null or \n        NonPrimaryDiagnosisDate is not null\n    )\n    and (CancerHistology is not null and CancerTopography is not null)\n    ",
      "lookup_table_markdown": "\r\n\r\n|BasisOfDiagnosisCancer|condition_status_concept_id|notes|\r\n|------|-----|-----|\r\n|0|32895|Death diagnosis|\r\n|1|32899|Preliminary diagnosis|\r\n|2|32899|Preliminary diagnosis|\r\n|4|32893|Confirmed diagnosis|\r\n|5|32893|Confirmed diagnosis|\r\n|6|32908|Secondary diagnosis|\r\n|7|32902|Primary diagnosis|\r\n|9|||\r\n\r\nNotes\r\n* [OMOP Condition Status](https://athena.ohdsi.org/search-terms/terms?domain=Condition+Status&standardConcept=Standard&page=1&pageSize=50&query=)\r\n* [NHS Basis of Diagnosis of Cancer](https://www.datadictionary.nhs.uk/attributes/basis_of_diagnosis_for_cancer.html?hl=basis%2Cdiagnosis%2Ccancer)\r\n"
    },
    {
      "name": "condition_status_source_value",
      "operation_description": "Value copied from `BasisOfDiagnosisCancer`",
      "dataSource": [
        {
          "name": "BasisOfDiagnosisCancer",
          "description": "The basis of how a PATIENT DIAGNOSIS relating to cancer was identified.",
          "origins": [
            {
              "origin": "BASIS OF DIAGNOSIS (CANCER)",
              "url": "https://www.datadictionary.nhs.uk/data_elements/basis_of_diagnosis__cancer_.html"
            }
          ]
        }
      ],
      "query": "\nwith BR as (\n  select \n    Record ->> '$.Breast.BreastCore.BreastCoreLinkagePatientId.NHSNumber.@extension' as NhsNumber,\n    Record ->> '$.Breast.BreastCore.BreastCoreLinkageDiagnosticDetails.ClinicalDateCancerDiagnosis' as DiagnosisDate,\n    Record ->> '$.Breast.BreastCore.BreastCoreLinkageDiagnosticDetails.DateOfNonPrimaryCancerDiagnosisClinicallyAgreed' as NonPrimaryDiagnosisDate,\n    Record ->> '$.Breast.BreastCore.BreastCoreDiagnosis.MorphologyICDODiagnosis.@code' as CancerHistology,\n    Record ->> '$.Breast.BreastCore.BreastCoreDiagnosis.TopographyICDO.@code' as CancerTopography,\n    Record ->> '$.Breast.BreastCore.BreastCoreDiagnosis.BasisOfCancerDiagnosis.@code' as BasisOfDiagnosisCancer,\n    Record ->> '$.Breast.BreastCore.BreastCoreLinkageDiagnosticDetails.PrimaryDiagnosis.@code' as CancerDiagnosis\n  from omop_staging.cosd_staging_81\nwhere Type = 'BR'\n)\nselect \n    distinct\n        NhsNumber,\n        coalesce (DiagnosisDate, NonPrimaryDiagnosisDate) as DiagnosisDate,\n        BasisOfDiagnosisCancer,\n        CancerHistology,\n        CancerTopography\nfrom BR\nwhere NhsNumber is not null and\n    (\n        DiagnosisDate is not null or \n        NonPrimaryDiagnosisDate is not null\n    )\n    and (CancerHistology is not null and CancerTopography is not null)\n    ",
      "lookup_table_markdown": null
    }
  ]
}
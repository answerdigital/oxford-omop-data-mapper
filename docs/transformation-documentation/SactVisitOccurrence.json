{
  "omopTable": "VisitOccurrence",
  "origin": "SACT",
  "omopColumns": [
    {
      "name": "NhsNumber",
      "operation_description": "Value copied from `NHS_Number`",
      "dataSource": [
        {
          "name": "NHS_Number",
          "description": "Patient NHS Number",
          "origins": [
            {
              "origin": "NHS NUMBER",
              "url": "https://www.datadictionary.nhs.uk/data_elements/nhs_number.html"
            }
          ]
        }
      ],
      "query": "\n\t\tselect distinct \n\t\t\tNHS_Number,\n\t\t\tCASE\n\t\t\t\t-- Check for yyyy-MM-dd format (contains dash and year first)\n\t\t\t\tWHEN Administration_Date LIKE '____-__-__' \n\t\t\t\t\tTHEN CAST(strptime(Administration_Date, '%Y-%m-%d') AS TIMESTAMP)\n\t\t\t\t-- dd/MM/yyyy format, where day is between 1 and 31\n\t\t\t    WHEN Administration_Date LIKE '__/__/____' AND CAST(substring(Administration_Date, 1, 2) AS INTEGER) BETWEEN 1 AND 31\n\t\t\t\t    THEN CAST(strptime(Administration_Date, '%d/%m/%Y') AS TIMESTAMP)\n\t\t\t\t-- Otherwise assume MM/dd/yyyy format\n\t\t\t\tWHEN Administration_Date LIKE '__/__/____'\n\t\t\t\t\tTHEN CAST(strptime(Administration_Date, '%m/%d/%Y') AS TIMESTAMP)\n\t\t\t\tELSE NULL\n\t\t\tEND AS Administration_Date \n\t\tfrom omop_staging.sact_staging\n\t",
      "lookup_table_markdown": null
    },
    {
      "name": "visit_start_date",
      "operation_description": "Converts text to dates.",
      "dataSource": [
        {
          "name": "Administration_date",
          "description": "Date when drug was administered or date an oral drug was initially dispensed to the patient",
          "origins": [
            {
              "origin": "SYSTEMIC ANTI-CANCER THERAPY ADMINISTRATION DATE",
              "url": "https://www.datadictionary.nhs.uk/data_elements/systemic_anti-cancer_therapy_administration_date.html"
            }
          ]
        }
      ],
      "query": "\n\t\tselect distinct \n\t\t\tNHS_Number,\n\t\t\tCASE\n\t\t\t\t-- Check for yyyy-MM-dd format (contains dash and year first)\n\t\t\t\tWHEN Administration_Date LIKE '____-__-__' \n\t\t\t\t\tTHEN CAST(strptime(Administration_Date, '%Y-%m-%d') AS TIMESTAMP)\n\t\t\t\t-- dd/MM/yyyy format, where day is between 1 and 31\n\t\t\t    WHEN Administration_Date LIKE '__/__/____' AND CAST(substring(Administration_Date, 1, 2) AS INTEGER) BETWEEN 1 AND 31\n\t\t\t\t    THEN CAST(strptime(Administration_Date, '%d/%m/%Y') AS TIMESTAMP)\n\t\t\t\t-- Otherwise assume MM/dd/yyyy format\n\t\t\t\tWHEN Administration_Date LIKE '__/__/____'\n\t\t\t\t\tTHEN CAST(strptime(Administration_Date, '%m/%d/%Y') AS TIMESTAMP)\n\t\t\t\tELSE NULL\n\t\t\tEND AS Administration_Date \n\t\tfrom omop_staging.sact_staging\n\t",
      "lookup_table_markdown": null
    },
    {
      "name": "visit_start_datetime",
      "operation_description": "Converts text to dates.",
      "dataSource": [
        {
          "name": "Administration_date",
          "description": "Date when drug was administered or date an oral drug was initially dispensed to the patient",
          "origins": [
            {
              "origin": "SYSTEMIC ANTI-CANCER THERAPY ADMINISTRATION DATE",
              "url": "https://www.datadictionary.nhs.uk/data_elements/systemic_anti-cancer_therapy_administration_date.html"
            }
          ]
        }
      ],
      "query": "\n\t\tselect distinct \n\t\t\tNHS_Number,\n\t\t\tCASE\n\t\t\t\t-- Check for yyyy-MM-dd format (contains dash and year first)\n\t\t\t\tWHEN Administration_Date LIKE '____-__-__' \n\t\t\t\t\tTHEN CAST(strptime(Administration_Date, '%Y-%m-%d') AS TIMESTAMP)\n\t\t\t\t-- dd/MM/yyyy format, where day is between 1 and 31\n\t\t\t    WHEN Administration_Date LIKE '__/__/____' AND CAST(substring(Administration_Date, 1, 2) AS INTEGER) BETWEEN 1 AND 31\n\t\t\t\t    THEN CAST(strptime(Administration_Date, '%d/%m/%Y') AS TIMESTAMP)\n\t\t\t\t-- Otherwise assume MM/dd/yyyy format\n\t\t\t\tWHEN Administration_Date LIKE '__/__/____'\n\t\t\t\t\tTHEN CAST(strptime(Administration_Date, '%m/%d/%Y') AS TIMESTAMP)\n\t\t\t\tELSE NULL\n\t\t\tEND AS Administration_Date \n\t\tfrom omop_staging.sact_staging\n\t",
      "lookup_table_markdown": null
    },
    {
      "name": "visit_end_date",
      "operation_description": "Converts text to dates.",
      "dataSource": [
        {
          "name": "Administration_date",
          "description": "Date when drug was administered or date an oral drug was initially dispensed to the patient",
          "origins": [
            {
              "origin": "SYSTEMIC ANTI-CANCER THERAPY ADMINISTRATION DATE",
              "url": "https://www.datadictionary.nhs.uk/data_elements/systemic_anti-cancer_therapy_administration_date.html"
            }
          ]
        }
      ],
      "query": "\n\t\tselect distinct \n\t\t\tNHS_Number,\n\t\t\tCASE\n\t\t\t\t-- Check for yyyy-MM-dd format (contains dash and year first)\n\t\t\t\tWHEN Administration_Date LIKE '____-__-__' \n\t\t\t\t\tTHEN CAST(strptime(Administration_Date, '%Y-%m-%d') AS TIMESTAMP)\n\t\t\t\t-- dd/MM/yyyy format, where day is between 1 and 31\n\t\t\t    WHEN Administration_Date LIKE '__/__/____' AND CAST(substring(Administration_Date, 1, 2) AS INTEGER) BETWEEN 1 AND 31\n\t\t\t\t    THEN CAST(strptime(Administration_Date, '%d/%m/%Y') AS TIMESTAMP)\n\t\t\t\t-- Otherwise assume MM/dd/yyyy format\n\t\t\t\tWHEN Administration_Date LIKE '__/__/____'\n\t\t\t\t\tTHEN CAST(strptime(Administration_Date, '%m/%d/%Y') AS TIMESTAMP)\n\t\t\t\tELSE NULL\n\t\t\tEND AS Administration_Date \n\t\tfrom omop_staging.sact_staging\n\t",
      "lookup_table_markdown": null
    },
    {
      "name": "visit_end_datetime",
      "operation_description": "Converts text to dates.",
      "dataSource": [
        {
          "name": "Administration_date",
          "description": "Date when drug was administered or date an oral drug was initially dispensed to the patient",
          "origins": [
            {
              "origin": "SYSTEMIC ANTI-CANCER THERAPY ADMINISTRATION DATE",
              "url": "https://www.datadictionary.nhs.uk/data_elements/systemic_anti-cancer_therapy_administration_date.html"
            }
          ]
        }
      ],
      "query": "\n\t\tselect distinct \n\t\t\tNHS_Number,\n\t\t\tCASE\n\t\t\t\t-- Check for yyyy-MM-dd format (contains dash and year first)\n\t\t\t\tWHEN Administration_Date LIKE '____-__-__' \n\t\t\t\t\tTHEN CAST(strptime(Administration_Date, '%Y-%m-%d') AS TIMESTAMP)\n\t\t\t\t-- dd/MM/yyyy format, where day is between 1 and 31\n\t\t\t    WHEN Administration_Date LIKE '__/__/____' AND CAST(substring(Administration_Date, 1, 2) AS INTEGER) BETWEEN 1 AND 31\n\t\t\t\t    THEN CAST(strptime(Administration_Date, '%d/%m/%Y') AS TIMESTAMP)\n\t\t\t\t-- Otherwise assume MM/dd/yyyy format\n\t\t\t\tWHEN Administration_Date LIKE '__/__/____'\n\t\t\t\t\tTHEN CAST(strptime(Administration_Date, '%m/%d/%Y') AS TIMESTAMP)\n\t\t\t\tELSE NULL\n\t\t\tEND AS Administration_Date \n\t\tfrom omop_staging.sact_staging\n\t",
      "lookup_table_markdown": null
    },
    {
      "name": "visit_concept_id",
      "operation_description": "Constant value set to `38004268`. `Oncology Clinic/Center`",
      "dataSource": null,
      "query": null,
      "lookup_table_markdown": null
    },
    {
      "name": "visit_type_concept_id",
      "operation_description": "Constant value set to `32818`. `EHR administration record`",
      "dataSource": null,
      "query": null,
      "lookup_table_markdown": null
    }
  ]
}
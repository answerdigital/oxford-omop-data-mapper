{
  "omopTable": "Observation",
  "origin": "COSD",
  "omopColumns": [
    {
      "name": "nhs_number",
      "operation_description": "Value copied from `NhsNumber`",
      "dataSource": [
        {
          "name": "NhsNumber",
          "description": "Patient NHS Number",
          "origins": [
            {
              "origin": "NHS NUMBER",
              "url": null
            }
          ]
        }
      ],
      "query": "\nwith CO as (\nselect \n  Record ->> '$.Colorectal.ColorectalCore.ColorectalCoreReferralAndFirstStageOfPatientPathway.DateFirstSeen' as DateFirstSeen,\nRecord ->> '$.Colorectal.ColorectalCore.ColorectalCoreReferralAndFirstStageOfPatientPathway.SpecialistDateFirstSeen' as SpecialistDateFirstSeen,\nRecord ->> '$.Colorectal.ColorectalCore.ColorectalCoreLinkageDiagnosticDetails.ClinicalDateCancerDiagnosis' as ClinicalDateCancerDiagnosis,\nRecord ->> '$.Colorectal.ColorectalCore.ColorectalCoreStaging.IntegratedStageTNMStageGroupingDate' as IntegratedStageTNMStageGroupingDate,\nRecord ->> '$.Colorectal.ColorectalCore.ColorectalCoreStaging.FinalPreTreatmentTNMStageGroupingDate' as FinalPreTreatmentTNMStageGroupingDate,\ncoalesce(Record ->> '$.Colorectal.ColorectalCore.ColorectalCoreTreatment[0].CancerTreatmentStartDate', Record ->> '$.Colorectal.ColorectalCore.ColorectalCoreTreatment.CancerTreatmentStartDate') as CancerTreatmentStartDate,\ncoalesce(Record ->> '$.Colorectal.ColorectalCore.ColorectalCoreTreatment[0].ColorectalCoreSurgeryAndOtherProcedures.ProcedureDate', Record ->> '$.Colorectal.ColorectalCore.ColorectalCoreTreatment.ColorectalCoreSurgeryAndOtherProcedures.ProcedureDate') as ProcedureDate,\nRecord ->> '$.Colorectal.ColorectalCore.ColorectalCoreClinicalNurseSpecialistAndRiskFactorAssessments.SmokingStatusCode.@code' as SmokingStatusCode,\nRecord ->> '$.Colorectal.ColorectalCore.ColorectalCoreLinkagePatientId.NHSNumber.@extension' as NhsNumber\nfrom omop_staging.cosd_staging_81\nwhere Type = 'CO'\n)\nselect\n      distinct\n          SmokingStatusCode,\n          NhsNumber,\n          least(\n                cast (DateFirstSeen as date),\n                cast (SpecialistDateFirstSeen as date),\n                cast (ClinicalDateCancerDiagnosis as date),\n                cast (IntegratedStageTNMStageGroupingDate as date),\n                cast (FinalPreTreatmentTNMStageGroupingDate as date),\n                cast (CancerTreatmentStartDate as date),\n                cast (ProcedureDate as date)\n              ) as Date\nfrom CO o\nwhere o.SmokingStatusCode is not null\n  and not (\n\t\tDateFirstSeen is null and\n\t\tSpecialistDateFirstSeen is null and\n\t\tClinicalDateCancerDiagnosis is null and\n\t\tIntegratedStageTNMStageGroupingDate is null and\n\t\tFinalPreTreatmentTNMStageGroupingDate is null and\n\t\tCancerTreatmentStartDate is null and\n\t\tProcedureDate is null\n    )\n    ",
      "lookup_table_markdown": null
    },
    {
      "name": "observation_concept_id",
      "operation_description": "Constant value set to `43054909`. Tobacco smoking status",
      "dataSource": null,
      "query": null,
      "lookup_table_markdown": null
    },
    {
      "name": "observation_date",
      "operation_description": "Value copied from `Date`",
      "dataSource": [
        {
          "name": "Date",
          "description": "Observation date",
          "origins": [
            {
              "origin": "DATE FIRST SEEN",
              "url": null
            },
            {
              "origin": "DATE FIRST SEEN (CANCER SPECIALIST)",
              "url": null
            },
            {
              "origin": "DIAGNOSIS DATE",
              "url": null
            },
            {
              "origin": "TNM STAGE GROUPING DATE (INTEGRATED)",
              "url": null
            },
            {
              "origin": "TNM STAGE GROUPING DATE (FINAL PRETREATMENT)",
              "url": null
            },
            {
              "origin": "TREATMENT START DATE (CANCER)",
              "url": null
            },
            {
              "origin": "PROCEDURE DATE",
              "url": null
            }
          ]
        }
      ],
      "query": "\nwith CO as (\nselect \n  Record ->> '$.Colorectal.ColorectalCore.ColorectalCoreReferralAndFirstStageOfPatientPathway.DateFirstSeen' as DateFirstSeen,\nRecord ->> '$.Colorectal.ColorectalCore.ColorectalCoreReferralAndFirstStageOfPatientPathway.SpecialistDateFirstSeen' as SpecialistDateFirstSeen,\nRecord ->> '$.Colorectal.ColorectalCore.ColorectalCoreLinkageDiagnosticDetails.ClinicalDateCancerDiagnosis' as ClinicalDateCancerDiagnosis,\nRecord ->> '$.Colorectal.ColorectalCore.ColorectalCoreStaging.IntegratedStageTNMStageGroupingDate' as IntegratedStageTNMStageGroupingDate,\nRecord ->> '$.Colorectal.ColorectalCore.ColorectalCoreStaging.FinalPreTreatmentTNMStageGroupingDate' as FinalPreTreatmentTNMStageGroupingDate,\ncoalesce(Record ->> '$.Colorectal.ColorectalCore.ColorectalCoreTreatment[0].CancerTreatmentStartDate', Record ->> '$.Colorectal.ColorectalCore.ColorectalCoreTreatment.CancerTreatmentStartDate') as CancerTreatmentStartDate,\ncoalesce(Record ->> '$.Colorectal.ColorectalCore.ColorectalCoreTreatment[0].ColorectalCoreSurgeryAndOtherProcedures.ProcedureDate', Record ->> '$.Colorectal.ColorectalCore.ColorectalCoreTreatment.ColorectalCoreSurgeryAndOtherProcedures.ProcedureDate') as ProcedureDate,\nRecord ->> '$.Colorectal.ColorectalCore.ColorectalCoreClinicalNurseSpecialistAndRiskFactorAssessments.SmokingStatusCode.@code' as SmokingStatusCode,\nRecord ->> '$.Colorectal.ColorectalCore.ColorectalCoreLinkagePatientId.NHSNumber.@extension' as NhsNumber\nfrom omop_staging.cosd_staging_81\nwhere Type = 'CO'\n)\nselect\n      distinct\n          SmokingStatusCode,\n          NhsNumber,\n          least(\n                cast (DateFirstSeen as date),\n                cast (SpecialistDateFirstSeen as date),\n                cast (ClinicalDateCancerDiagnosis as date),\n                cast (IntegratedStageTNMStageGroupingDate as date),\n                cast (FinalPreTreatmentTNMStageGroupingDate as date),\n                cast (CancerTreatmentStartDate as date),\n                cast (ProcedureDate as date)\n              ) as Date\nfrom CO o\nwhere o.SmokingStatusCode is not null\n  and not (\n\t\tDateFirstSeen is null and\n\t\tSpecialistDateFirstSeen is null and\n\t\tClinicalDateCancerDiagnosis is null and\n\t\tIntegratedStageTNMStageGroupingDate is null and\n\t\tFinalPreTreatmentTNMStageGroupingDate is null and\n\t\tCancerTreatmentStartDate is null and\n\t\tProcedureDate is null\n    )\n    ",
      "lookup_table_markdown": null
    },
    {
      "name": "observation_datetime",
      "operation_description": "Value copied from `Date`",
      "dataSource": [
        {
          "name": "Date",
          "description": "Observation date",
          "origins": [
            {
              "origin": "DATE FIRST SEEN",
              "url": null
            },
            {
              "origin": "DATE FIRST SEEN (CANCER SPECIALIST)",
              "url": null
            },
            {
              "origin": "DIAGNOSIS DATE",
              "url": null
            },
            {
              "origin": "TNM STAGE GROUPING DATE (INTEGRATED)",
              "url": null
            },
            {
              "origin": "TNM STAGE GROUPING DATE (FINAL PRETREATMENT)",
              "url": null
            },
            {
              "origin": "TREATMENT START DATE (CANCER)",
              "url": null
            },
            {
              "origin": "PROCEDURE DATE",
              "url": null
            }
          ]
        }
      ],
      "query": "\nwith CO as (\nselect \n  Record ->> '$.Colorectal.ColorectalCore.ColorectalCoreReferralAndFirstStageOfPatientPathway.DateFirstSeen' as DateFirstSeen,\nRecord ->> '$.Colorectal.ColorectalCore.ColorectalCoreReferralAndFirstStageOfPatientPathway.SpecialistDateFirstSeen' as SpecialistDateFirstSeen,\nRecord ->> '$.Colorectal.ColorectalCore.ColorectalCoreLinkageDiagnosticDetails.ClinicalDateCancerDiagnosis' as ClinicalDateCancerDiagnosis,\nRecord ->> '$.Colorectal.ColorectalCore.ColorectalCoreStaging.IntegratedStageTNMStageGroupingDate' as IntegratedStageTNMStageGroupingDate,\nRecord ->> '$.Colorectal.ColorectalCore.ColorectalCoreStaging.FinalPreTreatmentTNMStageGroupingDate' as FinalPreTreatmentTNMStageGroupingDate,\ncoalesce(Record ->> '$.Colorectal.ColorectalCore.ColorectalCoreTreatment[0].CancerTreatmentStartDate', Record ->> '$.Colorectal.ColorectalCore.ColorectalCoreTreatment.CancerTreatmentStartDate') as CancerTreatmentStartDate,\ncoalesce(Record ->> '$.Colorectal.ColorectalCore.ColorectalCoreTreatment[0].ColorectalCoreSurgeryAndOtherProcedures.ProcedureDate', Record ->> '$.Colorectal.ColorectalCore.ColorectalCoreTreatment.ColorectalCoreSurgeryAndOtherProcedures.ProcedureDate') as ProcedureDate,\nRecord ->> '$.Colorectal.ColorectalCore.ColorectalCoreClinicalNurseSpecialistAndRiskFactorAssessments.SmokingStatusCode.@code' as SmokingStatusCode,\nRecord ->> '$.Colorectal.ColorectalCore.ColorectalCoreLinkagePatientId.NHSNumber.@extension' as NhsNumber\nfrom omop_staging.cosd_staging_81\nwhere Type = 'CO'\n)\nselect\n      distinct\n          SmokingStatusCode,\n          NhsNumber,\n          least(\n                cast (DateFirstSeen as date),\n                cast (SpecialistDateFirstSeen as date),\n                cast (ClinicalDateCancerDiagnosis as date),\n                cast (IntegratedStageTNMStageGroupingDate as date),\n                cast (FinalPreTreatmentTNMStageGroupingDate as date),\n                cast (CancerTreatmentStartDate as date),\n                cast (ProcedureDate as date)\n              ) as Date\nfrom CO o\nwhere o.SmokingStatusCode is not null\n  and not (\n\t\tDateFirstSeen is null and\n\t\tSpecialistDateFirstSeen is null and\n\t\tClinicalDateCancerDiagnosis is null and\n\t\tIntegratedStageTNMStageGroupingDate is null and\n\t\tFinalPreTreatmentTNMStageGroupingDate is null and\n\t\tCancerTreatmentStartDate is null and\n\t\tProcedureDate is null\n    )\n    ",
      "lookup_table_markdown": null
    },
    {
      "name": "observation_type_concept_id",
      "operation_description": "Constant value set to `32828`. `EHR episode record`",
      "dataSource": null,
      "query": null,
      "lookup_table_markdown": null
    },
    {
      "name": "value_as_number",
      "operation_description": "Converts text to number.",
      "dataSource": [
        {
          "name": "SmokingStatusCode",
          "description": "SMOKING STATUS (CANCER) is for use in the Cancer Outcomes and Services Data Set: Core to identify if the PATIENT smokes tobacco only.",
          "origins": [
            {
              "origin": "SMOKING STATUS (CANCER)",
              "url": null
            }
          ]
        }
      ],
      "query": "\nwith CO as (\nselect \n  Record ->> '$.Colorectal.ColorectalCore.ColorectalCoreReferralAndFirstStageOfPatientPathway.DateFirstSeen' as DateFirstSeen,\nRecord ->> '$.Colorectal.ColorectalCore.ColorectalCoreReferralAndFirstStageOfPatientPathway.SpecialistDateFirstSeen' as SpecialistDateFirstSeen,\nRecord ->> '$.Colorectal.ColorectalCore.ColorectalCoreLinkageDiagnosticDetails.ClinicalDateCancerDiagnosis' as ClinicalDateCancerDiagnosis,\nRecord ->> '$.Colorectal.ColorectalCore.ColorectalCoreStaging.IntegratedStageTNMStageGroupingDate' as IntegratedStageTNMStageGroupingDate,\nRecord ->> '$.Colorectal.ColorectalCore.ColorectalCoreStaging.FinalPreTreatmentTNMStageGroupingDate' as FinalPreTreatmentTNMStageGroupingDate,\ncoalesce(Record ->> '$.Colorectal.ColorectalCore.ColorectalCoreTreatment[0].CancerTreatmentStartDate', Record ->> '$.Colorectal.ColorectalCore.ColorectalCoreTreatment.CancerTreatmentStartDate') as CancerTreatmentStartDate,\ncoalesce(Record ->> '$.Colorectal.ColorectalCore.ColorectalCoreTreatment[0].ColorectalCoreSurgeryAndOtherProcedures.ProcedureDate', Record ->> '$.Colorectal.ColorectalCore.ColorectalCoreTreatment.ColorectalCoreSurgeryAndOtherProcedures.ProcedureDate') as ProcedureDate,\nRecord ->> '$.Colorectal.ColorectalCore.ColorectalCoreClinicalNurseSpecialistAndRiskFactorAssessments.SmokingStatusCode.@code' as SmokingStatusCode,\nRecord ->> '$.Colorectal.ColorectalCore.ColorectalCoreLinkagePatientId.NHSNumber.@extension' as NhsNumber\nfrom omop_staging.cosd_staging_81\nwhere Type = 'CO'\n)\nselect\n      distinct\n          SmokingStatusCode,\n          NhsNumber,\n          least(\n                cast (DateFirstSeen as date),\n                cast (SpecialistDateFirstSeen as date),\n                cast (ClinicalDateCancerDiagnosis as date),\n                cast (IntegratedStageTNMStageGroupingDate as date),\n                cast (FinalPreTreatmentTNMStageGroupingDate as date),\n                cast (CancerTreatmentStartDate as date),\n                cast (ProcedureDate as date)\n              ) as Date\nfrom CO o\nwhere o.SmokingStatusCode is not null\n  and not (\n\t\tDateFirstSeen is null and\n\t\tSpecialistDateFirstSeen is null and\n\t\tClinicalDateCancerDiagnosis is null and\n\t\tIntegratedStageTNMStageGroupingDate is null and\n\t\tFinalPreTreatmentTNMStageGroupingDate is null and\n\t\tCancerTreatmentStartDate is null and\n\t\tProcedureDate is null\n    )\n    ",
      "lookup_table_markdown": null
    }
  ]
}
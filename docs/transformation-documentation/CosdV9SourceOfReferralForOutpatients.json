{
  "omopTable": "Observation",
  "origin": "COSD",
  "omopColumns": [
    {
      "name": "nhs_number",
      "operation_description": "Value copied from `NhsNumber`",
      "dataSource": [
        {
          "name": "NhsNumber",
          "description": "Patient NHS Number",
          "origins": [
            {
              "origin": "NHS NUMBER",
              "url": "https://www.datadictionary.nhs.uk/data_elements/nhs_number.html"
            }
          ]
        }
      ],
      "query": "\nwith CO as (\n\tselect\n\t\tRecord ->> '$.PrimaryPathway.ReferralAndFirstStageOfPatientPathway.DateFirstSeen' as DateFirstSeen,\n\t\tRecord ->> '$.PrimaryPathway.ReferralAndFirstStageOfPatientPathway.DateFirstSeenCancerSpecialist' as DateFirstSeenCancerSpecialist,\n\t\tRecord ->> '$.PrimaryPathway.LinkageDiagnosticDetails.DateOfPrimaryDiagnosisClinicallyAgreed' as DateOfPrimaryDiagnosisClinicallyAgreed,\n\t\tRecord ->> '$.PrimaryPathway.Staging.StageDateFinalPretreatmentStage' as StageDateFinalPretreatmentStage,\n\t\tRecord ->> '$.PrimaryPathway.Staging.StageDateIntegratedStage' as StageDateIntegratedStage,\n\t\t  coalesce(Record ->> '$.Treatment[0].TreatmentStartDateCancer', Record ->> '$.Treatment.TreatmentStartDateCancer') as TreatmentStartDateCancer,\n\t\tcoalesce(Record ->> '$.Treatment[0].Surgery.ProcedureDate', Record ->> '$.Treatment.Surgery.ProcedureDate') as ProcedureDate,\n\t\tRecord ->> '$.PrimaryPathway.ReferralAndFirstStageOfPatientPathway.\"SourceOfReferralForOut-patients\".\"@code\"' as SourceOfReferralForOutpatients,\n\t\tRecord ->> '$.LinkagePatientId.NhsNumber.@extension' as NhsNumber\n\tfrom omop_staging.cosd_staging_901\n\twhere type = 'CO'\n)\nselect\n\tdistinct\n\t\tSourceOfReferralForOutpatients,\n\t\tNhsNumber,\n\t\tleast(\n\t\t\tcast(DateFirstSeen as date),\n\t\t\tcast(DateFirstSeenCancerSpecialist as date),\n\t\t\tcast(DateOfPrimaryDiagnosisClinicallyAgreed as date),\n\t\t\tcast(StageDateFinalPretreatmentStage as date),\n\t\t\tcast(StageDateIntegratedStage as date),\n\t\t\tcast(TreatmentStartDateCancer as date),\n\t\t\tcast(ProcedureDate as date)\n\t\t) as Date\nfrom CO o\nwhere o.SourceOfReferralForOutpatients is not null\n  and not (\n\t\tDateFirstSeen is null and\n\t\tDateFirstSeenCancerSpecialist is null and\n\t\tDateOfPrimaryDiagnosisClinicallyAgreed is null and\n\t\tStageDateFinalPretreatmentStage is null and\n\t\tStageDateIntegratedStage is null and\n\t\tTreatmentStartDateCancer is null and\n\t\tProcedureDate is null\n    );\n    ",
      "lookup_table_markdown": null
    },
    {
      "name": "observation_concept_id",
      "operation_description": "Constant value set to `4258129`. Referral by",
      "dataSource": null,
      "query": null,
      "lookup_table_markdown": null
    },
    {
      "name": "observation_date",
      "operation_description": "Value copied from `Date`",
      "dataSource": [
        {
          "name": "Date",
          "description": "Observation date",
          "origins": [
            {
              "origin": "DATE FIRST SEEN",
              "url": "https://www.datadictionary.nhs.uk/data_elements/date_first_seen.html"
            },
            {
              "origin": "DATE FIRST SEEN (CANCER SPECIALIST)",
              "url": "https://www.datadictionary.nhs.uk/data_elements/date_first_seen__cancer_specialist_.html"
            },
            {
              "origin": "DATE OF PRIMARY CANCER DIAGNOSIS (CLINICALLY AGREED)",
              "url": "https://www.datadictionary.nhs.uk/data_elements/date_of_primary_cancer_diagnosis__clinically_agreed_.html"
            },
            {
              "origin": "TNM STAGE GROUPING DATE (FINAL PRETREATMENT)",
              "url": "https://www.datadictionary.nhs.uk/data_elements/tnm_stage_grouping_date__final_pretreatment_.html"
            },
            {
              "origin": "TNM STAGE GROUPING DATE (INTEGRATED)",
              "url": "https://www.datadictionary.nhs.uk/data_elements/tnm_stage_grouping_date__integrated_.html"
            },
            {
              "origin": "TREATMENT START DATE (CANCER)",
              "url": "https://www.datadictionary.nhs.uk/data_elements/treatment_start_date__cancer_.html"
            },
            {
              "origin": "PROCEDURE DATE",
              "url": "https://www.datadictionary.nhs.uk/data_elements/procedure_date.html"
            }
          ]
        }
      ],
      "query": "\nwith CO as (\n\tselect\n\t\tRecord ->> '$.PrimaryPathway.ReferralAndFirstStageOfPatientPathway.DateFirstSeen' as DateFirstSeen,\n\t\tRecord ->> '$.PrimaryPathway.ReferralAndFirstStageOfPatientPathway.DateFirstSeenCancerSpecialist' as DateFirstSeenCancerSpecialist,\n\t\tRecord ->> '$.PrimaryPathway.LinkageDiagnosticDetails.DateOfPrimaryDiagnosisClinicallyAgreed' as DateOfPrimaryDiagnosisClinicallyAgreed,\n\t\tRecord ->> '$.PrimaryPathway.Staging.StageDateFinalPretreatmentStage' as StageDateFinalPretreatmentStage,\n\t\tRecord ->> '$.PrimaryPathway.Staging.StageDateIntegratedStage' as StageDateIntegratedStage,\n\t\t  coalesce(Record ->> '$.Treatment[0].TreatmentStartDateCancer', Record ->> '$.Treatment.TreatmentStartDateCancer') as TreatmentStartDateCancer,\n\t\tcoalesce(Record ->> '$.Treatment[0].Surgery.ProcedureDate', Record ->> '$.Treatment.Surgery.ProcedureDate') as ProcedureDate,\n\t\tRecord ->> '$.PrimaryPathway.ReferralAndFirstStageOfPatientPathway.\"SourceOfReferralForOut-patients\".\"@code\"' as SourceOfReferralForOutpatients,\n\t\tRecord ->> '$.LinkagePatientId.NhsNumber.@extension' as NhsNumber\n\tfrom omop_staging.cosd_staging_901\n\twhere type = 'CO'\n)\nselect\n\tdistinct\n\t\tSourceOfReferralForOutpatients,\n\t\tNhsNumber,\n\t\tleast(\n\t\t\tcast(DateFirstSeen as date),\n\t\t\tcast(DateFirstSeenCancerSpecialist as date),\n\t\t\tcast(DateOfPrimaryDiagnosisClinicallyAgreed as date),\n\t\t\tcast(StageDateFinalPretreatmentStage as date),\n\t\t\tcast(StageDateIntegratedStage as date),\n\t\t\tcast(TreatmentStartDateCancer as date),\n\t\t\tcast(ProcedureDate as date)\n\t\t) as Date\nfrom CO o\nwhere o.SourceOfReferralForOutpatients is not null\n  and not (\n\t\tDateFirstSeen is null and\n\t\tDateFirstSeenCancerSpecialist is null and\n\t\tDateOfPrimaryDiagnosisClinicallyAgreed is null and\n\t\tStageDateFinalPretreatmentStage is null and\n\t\tStageDateIntegratedStage is null and\n\t\tTreatmentStartDateCancer is null and\n\t\tProcedureDate is null\n    );\n    ",
      "lookup_table_markdown": null
    },
    {
      "name": "observation_datetime",
      "operation_description": "Value copied from `Date`",
      "dataSource": [
        {
          "name": "Date",
          "description": "Observation date",
          "origins": [
            {
              "origin": "DATE FIRST SEEN",
              "url": "https://www.datadictionary.nhs.uk/data_elements/date_first_seen.html"
            },
            {
              "origin": "DATE FIRST SEEN (CANCER SPECIALIST)",
              "url": "https://www.datadictionary.nhs.uk/data_elements/date_first_seen__cancer_specialist_.html"
            },
            {
              "origin": "DATE OF PRIMARY CANCER DIAGNOSIS (CLINICALLY AGREED)",
              "url": "https://www.datadictionary.nhs.uk/data_elements/date_of_primary_cancer_diagnosis__clinically_agreed_.html"
            },
            {
              "origin": "TNM STAGE GROUPING DATE (FINAL PRETREATMENT)",
              "url": "https://www.datadictionary.nhs.uk/data_elements/tnm_stage_grouping_date__final_pretreatment_.html"
            },
            {
              "origin": "TNM STAGE GROUPING DATE (INTEGRATED)",
              "url": "https://www.datadictionary.nhs.uk/data_elements/tnm_stage_grouping_date__integrated_.html"
            },
            {
              "origin": "TREATMENT START DATE (CANCER)",
              "url": "https://www.datadictionary.nhs.uk/data_elements/treatment_start_date__cancer_.html"
            },
            {
              "origin": "PROCEDURE DATE",
              "url": "https://www.datadictionary.nhs.uk/data_elements/procedure_date.html"
            }
          ]
        }
      ],
      "query": "\nwith CO as (\n\tselect\n\t\tRecord ->> '$.PrimaryPathway.ReferralAndFirstStageOfPatientPathway.DateFirstSeen' as DateFirstSeen,\n\t\tRecord ->> '$.PrimaryPathway.ReferralAndFirstStageOfPatientPathway.DateFirstSeenCancerSpecialist' as DateFirstSeenCancerSpecialist,\n\t\tRecord ->> '$.PrimaryPathway.LinkageDiagnosticDetails.DateOfPrimaryDiagnosisClinicallyAgreed' as DateOfPrimaryDiagnosisClinicallyAgreed,\n\t\tRecord ->> '$.PrimaryPathway.Staging.StageDateFinalPretreatmentStage' as StageDateFinalPretreatmentStage,\n\t\tRecord ->> '$.PrimaryPathway.Staging.StageDateIntegratedStage' as StageDateIntegratedStage,\n\t\t  coalesce(Record ->> '$.Treatment[0].TreatmentStartDateCancer', Record ->> '$.Treatment.TreatmentStartDateCancer') as TreatmentStartDateCancer,\n\t\tcoalesce(Record ->> '$.Treatment[0].Surgery.ProcedureDate', Record ->> '$.Treatment.Surgery.ProcedureDate') as ProcedureDate,\n\t\tRecord ->> '$.PrimaryPathway.ReferralAndFirstStageOfPatientPathway.\"SourceOfReferralForOut-patients\".\"@code\"' as SourceOfReferralForOutpatients,\n\t\tRecord ->> '$.LinkagePatientId.NhsNumber.@extension' as NhsNumber\n\tfrom omop_staging.cosd_staging_901\n\twhere type = 'CO'\n)\nselect\n\tdistinct\n\t\tSourceOfReferralForOutpatients,\n\t\tNhsNumber,\n\t\tleast(\n\t\t\tcast(DateFirstSeen as date),\n\t\t\tcast(DateFirstSeenCancerSpecialist as date),\n\t\t\tcast(DateOfPrimaryDiagnosisClinicallyAgreed as date),\n\t\t\tcast(StageDateFinalPretreatmentStage as date),\n\t\t\tcast(StageDateIntegratedStage as date),\n\t\t\tcast(TreatmentStartDateCancer as date),\n\t\t\tcast(ProcedureDate as date)\n\t\t) as Date\nfrom CO o\nwhere o.SourceOfReferralForOutpatients is not null\n  and not (\n\t\tDateFirstSeen is null and\n\t\tDateFirstSeenCancerSpecialist is null and\n\t\tDateOfPrimaryDiagnosisClinicallyAgreed is null and\n\t\tStageDateFinalPretreatmentStage is null and\n\t\tStageDateIntegratedStage is null and\n\t\tTreatmentStartDateCancer is null and\n\t\tProcedureDate is null\n    );\n    ",
      "lookup_table_markdown": null
    },
    {
      "name": "observation_type_concept_id",
      "operation_description": "Constant value set to `32828`. `EHR episode record`",
      "dataSource": null,
      "query": null,
      "lookup_table_markdown": null
    },
    {
      "name": "value_as_string",
      "operation_description": "Value copied from `SourceOfReferralForOutpatients`",
      "dataSource": [
        {
          "name": "SourceOfReferralForOutpatients",
          "description": "For specific National Code usage, see SOURCE OF REFERRAL FOR OUT-PATIENTS.",
          "origins": [
            {
              "origin": "SOURCE OF REFERRAL FOR OUT-PATIENTS",
              "url": "https://www.datadictionary.nhs.uk/data_elements/source_of_referral_for_out-patients.html"
            }
          ]
        }
      ],
      "query": "\nwith CO as (\n\tselect\n\t\tRecord ->> '$.PrimaryPathway.ReferralAndFirstStageOfPatientPathway.DateFirstSeen' as DateFirstSeen,\n\t\tRecord ->> '$.PrimaryPathway.ReferralAndFirstStageOfPatientPathway.DateFirstSeenCancerSpecialist' as DateFirstSeenCancerSpecialist,\n\t\tRecord ->> '$.PrimaryPathway.LinkageDiagnosticDetails.DateOfPrimaryDiagnosisClinicallyAgreed' as DateOfPrimaryDiagnosisClinicallyAgreed,\n\t\tRecord ->> '$.PrimaryPathway.Staging.StageDateFinalPretreatmentStage' as StageDateFinalPretreatmentStage,\n\t\tRecord ->> '$.PrimaryPathway.Staging.StageDateIntegratedStage' as StageDateIntegratedStage,\n\t\t  coalesce(Record ->> '$.Treatment[0].TreatmentStartDateCancer', Record ->> '$.Treatment.TreatmentStartDateCancer') as TreatmentStartDateCancer,\n\t\tcoalesce(Record ->> '$.Treatment[0].Surgery.ProcedureDate', Record ->> '$.Treatment.Surgery.ProcedureDate') as ProcedureDate,\n\t\tRecord ->> '$.PrimaryPathway.ReferralAndFirstStageOfPatientPathway.\"SourceOfReferralForOut-patients\".\"@code\"' as SourceOfReferralForOutpatients,\n\t\tRecord ->> '$.LinkagePatientId.NhsNumber.@extension' as NhsNumber\n\tfrom omop_staging.cosd_staging_901\n\twhere type = 'CO'\n)\nselect\n\tdistinct\n\t\tSourceOfReferralForOutpatients,\n\t\tNhsNumber,\n\t\tleast(\n\t\t\tcast(DateFirstSeen as date),\n\t\t\tcast(DateFirstSeenCancerSpecialist as date),\n\t\t\tcast(DateOfPrimaryDiagnosisClinicallyAgreed as date),\n\t\t\tcast(StageDateFinalPretreatmentStage as date),\n\t\t\tcast(StageDateIntegratedStage as date),\n\t\t\tcast(TreatmentStartDateCancer as date),\n\t\t\tcast(ProcedureDate as date)\n\t\t) as Date\nfrom CO o\nwhere o.SourceOfReferralForOutpatients is not null\n  and not (\n\t\tDateFirstSeen is null and\n\t\tDateFirstSeenCancerSpecialist is null and\n\t\tDateOfPrimaryDiagnosisClinicallyAgreed is null and\n\t\tStageDateFinalPretreatmentStage is null and\n\t\tStageDateIntegratedStage is null and\n\t\tTreatmentStartDateCancer is null and\n\t\tProcedureDate is null\n    );\n    ",
      "lookup_table_markdown": null
    }
  ]
}
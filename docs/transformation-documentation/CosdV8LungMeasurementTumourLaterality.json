{
  "omopTable": "Measurement",
  "origin": "COSD",
  "omopColumns": [
    {
      "name": "nhs_number",
      "operation_description": "Value copied from `NhsNumber`",
      "dataSource": [
        {
          "name": "NhsNumber",
          "description": "Patient NHS Number",
          "origins": [
            {
              "origin": "NHS NUMBER",
              "url": "https://www.datadictionary.nhs.uk/data_elements/nhs_number.html"
            }
          ]
        }
      ],
      "query": "\nwith lung as (\n    select\n        Record ->> '$.Lung.LungCore.LungCoreLinkagePatientId.NHSNumber.@extension' as NhsNumber,\n        Record ->> '$.Lung.LungCore.LungCoreLinkageDiagnosticDetails.ClinicalDateCancerDiagnosis' as ClinicalDateCancerDiagnosis,\n        Record ->> '$.Lung.LungCore.LungCoreLinkageDiagnosticDetails.DateOfNonPrimaryCancerDiagnosisClinicallyAgreed' as DateOfNonPrimaryCancerDiagnosisClinicallyAgreed,\n        Record ->> '$.Lung.LungCore.LungCoreLinkageDiagnosticDetails.TumourLaterality.@code' as TumourLaterality\n    from omop_staging.cosd_staging_81\n    where Type = 'LU'\n)\nselect distinct\n    NhsNumber,\n    coalesce(ClinicalDateCancerDiagnosis, DateOfNonPrimaryCancerDiagnosisClinicallyAgreed) as MeasurementDate,\n    TumourLaterality\nfrom lung\nwhere TumourLaterality is not null\n  and TumourLaterality in ('L','R','M','B')\n  and NhsNumber is not null;\n\n\t",
      "lookup_table_markdown": null
    },
    {
      "name": "measurement_date",
      "operation_description": "Converts text to dates.",
      "dataSource": [
        {
          "name": "MeasurementDate",
          "description": "Measurement Date is the date on which the Primary Cancer was confirmed or the Primary Cancer diagnosis was agreed. If this is not available, then it is the date when the diagnosis of the Non-Primary Cancer was clinically agreed.",
          "origins": [
            {
              "origin": "DATE OF PRIMARY CANCER DIAGNOSIS (CLINICALLY AGREED)",
              "url": "https://www.datadictionary.nhs.uk/data_elements/date_of_primary_cancer_diagnosis__clinically_agreed_.html"
            },
            {
              "origin": "DATE OF NON PRIMARY CANCER DIAGNOSIS (CLINICALLY AGREED)",
              "url": "https://www.datadictionary.nhs.uk/data_elements/date_of_non_primary_cancer_diagnosis__clinically_agreed_.html"
            }
          ]
        }
      ],
      "query": "\nwith lung as (\n    select\n        Record ->> '$.Lung.LungCore.LungCoreLinkagePatientId.NHSNumber.@extension' as NhsNumber,\n        Record ->> '$.Lung.LungCore.LungCoreLinkageDiagnosticDetails.ClinicalDateCancerDiagnosis' as ClinicalDateCancerDiagnosis,\n        Record ->> '$.Lung.LungCore.LungCoreLinkageDiagnosticDetails.DateOfNonPrimaryCancerDiagnosisClinicallyAgreed' as DateOfNonPrimaryCancerDiagnosisClinicallyAgreed,\n        Record ->> '$.Lung.LungCore.LungCoreLinkageDiagnosticDetails.TumourLaterality.@code' as TumourLaterality\n    from omop_staging.cosd_staging_81\n    where Type = 'LU'\n)\nselect distinct\n    NhsNumber,\n    coalesce(ClinicalDateCancerDiagnosis, DateOfNonPrimaryCancerDiagnosisClinicallyAgreed) as MeasurementDate,\n    TumourLaterality\nfrom lung\nwhere TumourLaterality is not null\n  and TumourLaterality in ('L','R','M','B')\n  and NhsNumber is not null;\n\n\t",
      "lookup_table_markdown": null
    },
    {
      "name": "measurement_datetime",
      "operation_description": "Converts text to dates.",
      "dataSource": [
        {
          "name": "MeasurementDate",
          "description": "Measurement Date is the date on which the Primary Cancer was confirmed or the Primary Cancer diagnosis was agreed. If this is not available, then it is the date when the diagnosis of the Non-Primary Cancer was clinically agreed.",
          "origins": [
            {
              "origin": "DATE OF PRIMARY CANCER DIAGNOSIS (CLINICALLY AGREED)",
              "url": "https://www.datadictionary.nhs.uk/data_elements/date_of_primary_cancer_diagnosis__clinically_agreed_.html"
            },
            {
              "origin": "DATE OF NON PRIMARY CANCER DIAGNOSIS (CLINICALLY AGREED)",
              "url": "https://www.datadictionary.nhs.uk/data_elements/date_of_non_primary_cancer_diagnosis__clinically_agreed_.html"
            }
          ]
        }
      ],
      "query": "\nwith lung as (\n    select\n        Record ->> '$.Lung.LungCore.LungCoreLinkagePatientId.NHSNumber.@extension' as NhsNumber,\n        Record ->> '$.Lung.LungCore.LungCoreLinkageDiagnosticDetails.ClinicalDateCancerDiagnosis' as ClinicalDateCancerDiagnosis,\n        Record ->> '$.Lung.LungCore.LungCoreLinkageDiagnosticDetails.DateOfNonPrimaryCancerDiagnosisClinicallyAgreed' as DateOfNonPrimaryCancerDiagnosisClinicallyAgreed,\n        Record ->> '$.Lung.LungCore.LungCoreLinkageDiagnosticDetails.TumourLaterality.@code' as TumourLaterality\n    from omop_staging.cosd_staging_81\n    where Type = 'LU'\n)\nselect distinct\n    NhsNumber,\n    coalesce(ClinicalDateCancerDiagnosis, DateOfNonPrimaryCancerDiagnosisClinicallyAgreed) as MeasurementDate,\n    TumourLaterality\nfrom lung\nwhere TumourLaterality is not null\n  and TumourLaterality in ('L','R','M','B')\n  and NhsNumber is not null;\n\n\t",
      "lookup_table_markdown": null
    },
    {
      "name": "measurement_type_concept_id",
      "operation_description": "Constant value set to `32828`. EHR episode record",
      "dataSource": null,
      "query": null,
      "lookup_table_markdown": null
    },
    {
      "name": "measurement_concept_id",
      "operation_description": "Lookup TumourLaterality concepts.",
      "dataSource": [
        {
          "name": "TumourLaterality",
          "description": "An indication of the side of the body on which the Primary Tumour originated. Valid values are: L (Left), R (Right), M (Midline), B (Bilateral).",
          "origins": [
            {
              "origin": "TUMOUR LATERALITY",
              "url": "https://www.datadictionary.nhs.uk/data_elements/tumour_laterality.html"
            }
          ]
        }
      ],
      "query": "\nwith lung as (\n    select\n        Record ->> '$.Lung.LungCore.LungCoreLinkagePatientId.NHSNumber.@extension' as NhsNumber,\n        Record ->> '$.Lung.LungCore.LungCoreLinkageDiagnosticDetails.ClinicalDateCancerDiagnosis' as ClinicalDateCancerDiagnosis,\n        Record ->> '$.Lung.LungCore.LungCoreLinkageDiagnosticDetails.DateOfNonPrimaryCancerDiagnosisClinicallyAgreed' as DateOfNonPrimaryCancerDiagnosisClinicallyAgreed,\n        Record ->> '$.Lung.LungCore.LungCoreLinkageDiagnosticDetails.TumourLaterality.@code' as TumourLaterality\n    from omop_staging.cosd_staging_81\n    where Type = 'LU'\n)\nselect distinct\n    NhsNumber,\n    coalesce(ClinicalDateCancerDiagnosis, DateOfNonPrimaryCancerDiagnosisClinicallyAgreed) as MeasurementDate,\n    TumourLaterality\nfrom lung\nwhere TumourLaterality is not null\n  and TumourLaterality in ('L','R','M','B')\n  and NhsNumber is not null;\n\n\t",
      "lookup_table_markdown": "\r\n\r\n|TumourLaterality|measurement_concept_id|notes|\r\n|------|-----|-----|\r\n|L|36770232|Left|\r\n|R|36770058|Right|\r\n|M|36769853|Midline|\r\n|B|36770109|Bilateral|\r\n\r\nNotes\r\n* [OMOP Laterality](https://athena.ohdsi.org/search-terms/terms?vocabulary=Cancer+Modifier&conceptClass=Topography&page=1&pageSize=500&query=&boosts)\r\n* [NHS - Tumour Laterality](https://www.datadictionary.nhs.uk/data_elements/tumour_laterality.html?hl=tumour%2Claterality)\r\n"
    },
    {
      "name": "measurement_source_value",
      "operation_description": "Value copied from `TumourLaterality`",
      "dataSource": [
        {
          "name": "TumourLaterality",
          "description": "An indication of the side of the body on which the Primary Tumour originated. Valid values are: L (Left), R (Right), M (Midline), B (Bilateral).",
          "origins": [
            {
              "origin": "TUMOUR LATERALITY",
              "url": "https://www.datadictionary.nhs.uk/data_elements/tumour_laterality.html"
            }
          ]
        }
      ],
      "query": "\nwith lung as (\n    select\n        Record ->> '$.Lung.LungCore.LungCoreLinkagePatientId.NHSNumber.@extension' as NhsNumber,\n        Record ->> '$.Lung.LungCore.LungCoreLinkageDiagnosticDetails.ClinicalDateCancerDiagnosis' as ClinicalDateCancerDiagnosis,\n        Record ->> '$.Lung.LungCore.LungCoreLinkageDiagnosticDetails.DateOfNonPrimaryCancerDiagnosisClinicallyAgreed' as DateOfNonPrimaryCancerDiagnosisClinicallyAgreed,\n        Record ->> '$.Lung.LungCore.LungCoreLinkageDiagnosticDetails.TumourLaterality.@code' as TumourLaterality\n    from omop_staging.cosd_staging_81\n    where Type = 'LU'\n)\nselect distinct\n    NhsNumber,\n    coalesce(ClinicalDateCancerDiagnosis, DateOfNonPrimaryCancerDiagnosisClinicallyAgreed) as MeasurementDate,\n    TumourLaterality\nfrom lung\nwhere TumourLaterality is not null\n  and TumourLaterality in ('L','R','M','B')\n  and NhsNumber is not null;\n\n\t",
      "lookup_table_markdown": null
    }
  ]
}
<Query>
    <Sql>
		select distinct
  			replace(NHS_Number, ' ', '') as NHSNumber,
			Intent_Of_Treatment,
			Case 
				When Intent_Of_Treatment = 1 then concat(Intent_Of_Treatment, ' - Curative(aiming to permanently eradicate disease)')
				When Intent_Of_Treatment = 2 then concat(Intent_Of_Treatment, ' - Palliative(aiming to extend life expectancy)')
				When Intent_Of_Treatment = 3 then concat(Intent_Of_Treatment, ' - Palliative(aiming to relieve and/or control malignancy related symptoms)')
				When Intent_Of_Treatment = 4 then concat(Intent_Of_Treatment, ' - Palliative(aiming to achieve remission)')
				When Intent_Of_Treatment = 5 then concat(Intent_Of_Treatment, ' - Palliative(aiming to permanently eradicate disease)')
				When Intent_Of_Treatment = 98 then concat(Intent_Of_Treatment, ' - Other (not listed)')
        		When Intent_Of_Treatment = 99 then concat(Intent_Of_Treatment, ' - Other (not listed)')
			else '' end as Source_value,
		  	CASE
				-- Check for yyyy-MM-dd format (contains dash and year first)
				WHEN Administration_Date LIKE '____-__-__' 
					THEN CAST(strptime(Administration_Date, '%Y-%m-%d') AS DATE)
				-- dd/MM/yyyy format, where day is between 1 and 31
			    WHEN Administration_Date LIKE '__/__/____' AND CAST(substring(Administration_Date, 1, 2) AS INTEGER) BETWEEN 1 AND 31
				    THEN CAST(strptime(Administration_Date, '%d/%m/%Y') AS DATE)
				-- Otherwise assume MM/dd/yyyy format
				WHEN Administration_Date LIKE '__/__/____'
					THEN CAST(strptime(Administration_Date, '%m/%d/%Y') AS DATE)
				ELSE NULL
			END AS Administration_Date
		from omop_staging.sact_staging
        where Intent_Of_Treatment != ''
	</Sql>
	<Explanations>
		<Explanation columnName="NHSNumber">
			<Description>Patient NHS Number</Description>
			<Origin>NHS NUMBER</Origin>
		</Explanation>
		<Explanation columnName="Intent_Of_Treatment">
			<Description>The intent of the Systemic Anti-Cancer Therapy Drug Regimen.</Description>
			<Origin>SYSTEMIC ANTI-CANCER THERAPY DRUG REGIMEN TREATMENT INTENT</Origin>
		</Explanation>
		<Explanation columnName="Source_value">
			<Description>Source value of the intent of the Systemic Anti-Cancer Therapy Drug Regimen.</Description>
			<Origin>SYSTEMIC ANTI-CANCER THERAPY DRUG REGIMEN TREATMENT INTENT</Origin>
		</Explanation>
		<Explanation columnName="Administration_Date">
			<Description>SYSTEMIC ANTI-CANCER THERAPY ADMINISTRATION DATE is the date of the Systemic Anti-Cancer Therapy Drug Administration or the date an oral drug was initially dispensed to the PATIENT.</Description>
			<Origin>SYSTEMIC ANTI-CANCER THERAPY ADMINISTRATION DATE</Origin>
		</Explanation>
	</Explanations>
</Query>
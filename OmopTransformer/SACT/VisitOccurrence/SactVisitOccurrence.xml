<Query>
    <Sql>
		select distinct 
			NHS_Number,
			CASE
				-- Check for yyyy-MM-dd format (contains dash and year first)
				WHEN Administration_Date LIKE '____-__-__' 
					THEN CAST(strptime(Administration_Date, '%Y-%m-%d') AS TIMESTAMP)
				-- dd/MM/yyyy format, where day is between 1 and 31
			    WHEN Administration_Date LIKE '__/__/____' AND CAST(substring(Administration_Date, 1, 2) AS INTEGER) BETWEEN 1 AND 31
				    THEN CAST(strptime(Administration_Date, '%d/%m/%Y') AS TIMESTAMP)
				-- Otherwise assume MM/dd/yyyy format
				WHEN Administration_Date LIKE '__/__/____'
					THEN CAST(strptime(Administration_Date, '%m/%d/%Y') AS TIMESTAMP)
				ELSE NULL
			END AS Administration_Date 
		from omop_staging.sact_staging
	</Sql>
	<Explanations>
		 <Explanation columnName="NHS_Number">
		    <Description>Patient NHS Number</Description>
		    <Origin>NHS NUMBER</Origin>
	    </Explanation>
		<Explanation columnName="Administration_Date">
			<Description>Date when drug was administered or date an oral drug was initially dispensed to the patient</Description>
			<Origin>SYSTEMIC ANTI-CANCER THERAPY ADMINISTRATION DATE</Origin>
		</Explanation>
	</Explanations>
</Query>
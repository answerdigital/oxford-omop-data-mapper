<Query>
    <Sql>
		select distinct
			(select PatientId from omop_staging.rtds_1_demographics d where d.PatientSer = dc.PatientSer limit 1) as NhsNumber,
			Treatmentdatetime,
			Cast(NominalEnergy as double) / 1000 as CalculatedNominalEnergy,
			NominalEnergy as NominalEnergy
		from omop_staging.RTDS_4_Exposures dc
		where NhsNumber is not null
		and regexp_matches(NhsNumber, '\d{10}')
		and NominalEnergy is not null 
		and NominalEnergy != '';
	</Sql>
	<Explanations>
		<Explanation columnName="NhsNumber">
			<Description>Patient NHS Number</Description>
			<Origin>NHS NUMBER</Origin>
		</Explanation>
		<Explanation columnName="Treatmentdatetime">
			<Description>Start date of treatment</Description>
		</Explanation>
		<Explanation columnName="NominalEnergy">
			<Description>RADIOTHERAPY PRESCRIBED BEAM ENERGY  is the prescribed beam energy of a Radiotherapy Exposure used in External Beam Radiotherapy</Description>
			<Origin>RADIOTHERAPY PRESCRIBED BEAM ENERGY</Origin>
		</Explanation>
		<Explanation columnName="CalculatedNominalEnergy">
			<Description>RADIOTHERAPY PRESCRIBED BEAM ENERGY  is the prescribed beam energy of a Radiotherapy Exposure used in External Beam Radiotherapy</Description>
			<Origin>RADIOTHERAPY PRESCRIBED BEAM ENERGY</Origin>
		</Explanation>
	</Explanations>
</Query>
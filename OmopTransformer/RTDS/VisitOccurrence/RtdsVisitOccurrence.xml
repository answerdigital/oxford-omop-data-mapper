<Query>
    <Sql>
	with results as (
			select 
				distinct
					(select PatientId from omop_staging.rtds_1_demographics d where d.PatientSer = a.PatientSer limit 1) as NhsNumber,
					a.start_date as event_start_date,
					a.end_date as event_end_date
					from omop_staging.rtds_2b_plan a
		)
		select
			NhsNumber,
			event_start_date,
			event_end_date
		from results
		where
			NhsNumber is not null
			and regexp_matches(NhsNumber, '\d{10}');
	</Sql>
	<Explanations>
		<Explanation columnName="NhsNumber">
			<Description>Patient NHS Number</Description>
			<Origin>NHS NUMBER</Origin>
		</Explanation>
		<Explanation columnName="event_start_date">
			<Description>Appointment Start Time</Description>
			<Origin>TREATMENT START DATE (RADIOTHERAPY TREATMENT EPISODE)</Origin>
		</Explanation>
		<Explanation columnName="event_end_date">
			<Description>Appointment End Time</Description>
		</Explanation>
	</Explanations>
</Query>
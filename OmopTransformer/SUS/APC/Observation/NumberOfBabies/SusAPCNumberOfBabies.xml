<Query>
    <Sql>
select
	apc.NHSNumber,
	apc.GeneratedRecordIdentifier,
	apc.HospitalProviderSpellNumber,
	coalesce(max(apc.DeliveryDate), max(apc.CDSActivityDate)) as observation_date,
	apc.NumberofBabies
from [omop_staging].[sus_APC] apc													
where apc.NHSNumber is not null
	and apc.NumberofBabies is not null
	and apc.CDSType in ('120','140')
group by
	apc.NHSNumber,
	apc.GeneratedRecordIdentifier, 
    apc.HospitalProviderSpellNumber,
	apc.DeliveryDate,
	apc.NumberofBabies;
	</Sql>

	<Explanations>
		<Explanation columnName="NHSNumber">
			<Description>Patient NHS Number</Description>
			<Origin>NHS NUMBER</Origin>
		</Explanation>
		<Explanation columnName="GeneratedRecordIdentifier">
			<Description>CDS specific identifier that binds multiple CDS messages together.</Description>
			<Origin>CDS RECORD IDENTIFIER</Origin>
		</Explanation>
		<Explanation columnName="HospitalProviderSpellNumber">
			<Description>CDS specific hospital spell number that binds many episodes together.</Description>
			<Origin>HOSPITAL PROVIDER SPELL NUMBER</Origin>
		</Explanation>
		<Explanation columnName="observation_date">
			<Description>Event date</Description>
			<Origin>CDS ACTIVITY DATE</Origin>
			<Origin>DELIVERY DATE</Origin>
		</Explanation>
		<Explanation columnName="NumberOfBabies">
			<Description>The number of REGISTRABLE BIRTHS (live or still born at a particular delivery).</Description>
			<Origin>NUMBER OF BABIES INDICATION CODE</Origin>
		</Explanation>
	</Explanations>
</Query>
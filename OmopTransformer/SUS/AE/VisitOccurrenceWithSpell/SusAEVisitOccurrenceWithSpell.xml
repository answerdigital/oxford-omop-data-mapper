<Query>
    <Sql>

	select  
		distinct
			ae.NHSNumber,
			ae.AEAttendanceNumber,

			coalesce(ae.ArrivalDate, ae.CDSActivityDate) as EpisodeStartDate,
			coalesce(ae.ArrivalTime, '000000') as EpisodeStartTime,
			coalesce(ae.AEDepartureDate, ae.AEAttendanceConclusionDate) as EpisodeEndDate,
			coalesce(ae.AEDepartureTime, ae.AEAttendanceConclusionTime, '000000') as EpisodeEndTime,

			ae.AEArrivalMode as SourceofAdmissionCode,
			ae.AEAttendanceDisposal as DischargeDestinationCode

	from omop_staging.sus_AE ae
	where ae.NHSNumber is not null

	</Sql>

	<Explanations>
		<Explanation columnName="NHSNumber">
			<Description>Patient NHS Number</Description>
			<Origin>NHS NUMBER</Origin>
		</Explanation>

		<Explanation columnName="AEAttendanceNumber">
			<Description>ATTENDANCE IDENTIFIER is a sequential number or time of day used to enable an attendance to be uniquely identified.</Description>
			<Origin>ATTENDANCE IDENTIFIER</Origin>
		</Explanation>

		<Explanation columnName="VisitStartDate">
			<Description>Start date of the episode.</Description>
			<Origin>START DATE (EPISODE)</Origin>
		</Explanation>

		<Explanation columnName="VisitStartTime">
			<Description>The earliest episode start time for the spell, or midnight if none are specified.</Description>
			<Origin>START TIME (EPISODE)</Origin>
		</Explanation>

		<Explanation columnName="VisitEndDate">
			<Description>The latest episode end date for the spell, or the latest activity date if none are specified.</Description>
			<Origin>CDS ACTIVITY DATE</Origin>
			<Origin>END DATE (EPISODE)</Origin>
		</Explanation>

		<Explanation columnName="VisitEndTime">
			<Description>The latest episode end time for the spell, or midnight if none are specified.</Description>
			<Origin>END TIME (EPISODE)</Origin>
		</Explanation>
	</Explanations>
</Query>

<Query>
    <Sql>

		select distinct
				apc.NHSNumber,
				apc.HospitalProviderSpellNumber,
				cc.CriticalCareStartDate as VisitStartDate,
				coalesce(cc.CriticalCareStartTime, '000000') as VisitStartTime,
				coalesce(cc.CriticalCarePeriodDischargeTime, cc.EventDate) as VisitEndDate,
				coalesce(cc.CriticalCarePeriodDischargeTime, cc.EventDate, '000000') as VisitEndTime
		from omop_staging.sus_CCMDS cc
		inner join omop_staging.sus_APC apc on cc.GeneratedRecordID = apc.GeneratedRecordIdentifier
		where apc.NHSNumber is not null

	</Sql>

	<Explanations>
		<Explanation columnName="NHSNumber">
			<Description>Patient NHS Number</Description>
			<Origin>NHS NUMBER</Origin>
		</Explanation>
		<Explanation columnName="HospitalProviderSpellNumber">
			<Description>CDS specific hospital spell number that binds many episodes together.</Description>
			<Origin>HOSPITAL PROVIDER SPELL NUMBER</Origin>
		</Explanation>

		<Explanation columnName="VisitStartDate">
			<Description>Start date of the episode, if exists, else the start date of the spell.</Description>
			<Origin>CRITICAL CARE START DATE</Origin>
		</Explanation>

		<Explanation columnName="VisitStartTime">
			<Description>Start time of the episode, if exists, else midnight.</Description>
			<Origin>CRITICAL CARE START TIME</Origin>
		</Explanation>

		<Explanation columnName="VisitEndDate">
			<Description>End date of the episode, if exists, else the spell discharge date, if exists, else the message date.</Description>
			<Origin>CRITICAL CARE PERIOD DISCHARGE DATE</Origin>
		</Explanation>
		<Explanation columnName="VisitEndTime">
			<Description>End time of the episode, if exists, else the spell discharge time, if exists, else the message date.</Description>
			<Origin>CRITICAL CARE PERIOD DISCHARGE</Origin>
		</Explanation>	</Explanations>
</Query>
